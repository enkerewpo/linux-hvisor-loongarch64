ROGRESS CODE: V03058001 I0
[INFO] arch_init done
                     [INFO] UEFI bootloader initialized!
[INFO] Hello! This is the UEFI bootloader of hvisor, arch = loongarch64
[INFO] hvisor binary stored in .data, from 0xED01B470 to 0xED138760
[INFO] CONFIG_EMBEDDED_HVISOR_BIN_PATH: ../hvisor/target/loongarch64-unknown-none/debug/hvisor.bin
[INFO] printing system info...
[INFO] runtime services addr: 0xFE16FF18
[INFO] boot services addr: 0xFE1E5FC8
[INFO] config table addr: 0xFE16FB18
[INFO] con in addr: 0xFDA428D0
[INFO] con out addr: 0xFDA42790
[INFO] before exit boot services...
[INFO] printing binary info...
---------------------------------------------------------------------
hvisor uefi packer target arch: loongarch64
hvisor binary range: 0x90000001F0000000 - 0x90000001F011D2F0
hvisor vmlinux.bin: 0x9000000000200000 - 0x9000000006060000
---------------------------------------------------------------------
[INFO] copying hvisor binary to 0x90000001F0000000...
[INFO] hvisor binary copied to 0x90000001F0000000, size: 0x11D2F0
[INFO] copying vmlinux binary to 0x9000000000200000...
[INFO] hvisor vmlinux.bin copied to 0x9000000000200000, size: 0x5E60000
[INFO] exiting boot services...
[INFO] check: GetMemoryMap (1st call) success
[INFO] exit_boot_services: memory_map_size = 1440
XhcClearBiosOwnership: called to clear BIOS ownership
PROGRESS CODE: V02010004 I0
DisableFloatExitBootServicesEventNotify
SetUefiImageMemoryAttributes - 0x00000000FDD60000 - 0x0000000000007000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDD50000 - 0x0000000000006000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDD30000 - 0x0000000000009000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDC70000 - 0x00000000000B5000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDC60000 - 0x0000000000006000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDC50000 - 0x0000000000007000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDC40000 - 0x0000000000006000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDC30000 - 0x0000000000005000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDC20000 - 0x0000000000005000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDC10000 - 0x0000000000006000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDC00000 - 0x0000000000006000 (0x0000000000000000)
SetUefiImageMemoryAttributes - 0x00000000FDBF0000 - 0x0000000000007000 (0x0000000000000000)
[INFO] exit_boot_services done
                              [INFO] ok, ready to jump to hvisor entry...
                                                                         Hello, start HVISOR at 0x90000001f0000000!
Heap allocator initialization finished: 0x90000001f0141068..0x90000001f0241068
heap_test passed!
Booting CPU 0: 0x90000001f0242000 arch:0x90000001f0242020, DTB: 0xfe160018
Hello, start HVISOR at 0x90000001f0000000!
Hello, start HVISOR at 0x90000001f0000000!
Hello, start HVISOR at 0x90000001f0000000!
Booting CPU 1: 0x90000001f02c2000 arch:0x90000001f02c2020, DTB: 0x9000000000000000
Booting CPU 3: 0x90000001f03c2000 arch:0x90000001f03c2020, DTB: 0x9000000000000000
Booting CPU 2: 0x90000001f0342000 arch:0x90000001f0342020, DTB: 0x9000000000000000
Secondary CPU 1 has entered.
Primary CPU 0 has entered.
Secondary CPU 3 has entered.
[INFO  0] (hvisor:115) Logging is enabled.
Secondary CPU 2 has entered.
[INFO  0] (hvisor:116) __core_end = 0x90000001f0242000
[INFO  0] (hvisor:117) mem_pool_start = 0x90000001f0442000
[INFO  0] (hvisor:118) hv_end = 0x90000001f4442000
[INFO  0] (hvisor:121) Hypervisor initialization in progress...
[INFO  0] (hvisor:122) build_mode: debug, log_level: info, arch: loongarch64, stats: off
[INFO  0] (hvisor::memory::frame:285) Frame allocator initialization finished: 0x90000001f0442000..0x90000001f4442000
[INFO  0] (hvisor::memory::frame:305) frame_allocator_test passed!
[INFO  0] (hvisor::arch::loongarch64::s2pt:199) Dynamical detection of stage-2 paging mode is not supported yet.
[INFO  0] (hvisor::device::irqchip::ls7a2000:40) loongarch64: irqchip: primary_init_early: checking iochip configs
[INFO  0] (hvisor::device::irqchip::ls7a2000::chip:576) loongarch64: print_chip_info: chip config version: 0x14
[INFO  0] (hvisor::device::irqchip::ls7a2000::chip:580) loongarch64: print_chip_info: chip feature extioi support: true
[INFO  0] (hvisor::device::irqchip::ls7a2000::chip:584) loongarch64: print_chip_info: manufacturer name: Loongson
[INFO  0] (hvisor::device::irqchip::ls7a2000::chip:588) loongarch64: print_chip_info: chip name: 3A6000-H
[INFO  0] (hvisor::device::irqchip::ls7a2000:45) loongarch64: irqchip: testing percore IPI feature
[INFO  0] (hvisor::device::irqchip::ls7a2000:47) loongarch64: irqchip: percore IPI feature: true
[WARN  0] (hvisor::pci::pci_config:50) begin [
    HvPciConfig {
        ecam_base: 1090921693184,
        ecam_size: 536870912,
        io_base: 406880256,
        io_size: 32768,
        pci_io_base: 32768,
        mem32_base: 0,
        mem32_size: 0,
        pci_mem32_base: 0,
        mem64_base: 1610612736,
        mem64_size: 536870912,
        pci_mem64_base: 1610612736,
        bus_range_begin: 0,
        bus_range_end: 255,
    },
]
[INFO  0] (hvisor::pci::pci_config:138) begin enumerate PciIterator {
    allocator: Some(
        LoongArchAllocator {
            mem: 1610612736..2147483648,
            mem_used: 1610612736,
            io: 406880256..406913024,
            io_used: 406880256,
        },
    ),
    stack: [
        Bridge {
            bus: 0,
            device: 0,
            function: 0,
            subordinate_bus: 0,
            secondary_bus: 0,
            primary_bus: 0,
            mmio: PciConfigMmio {
                base: 0,
                length: 0,
            },
            has_secondary_link: false,
            is_mulitple_function: false,
        },
    ],
    segment: 1090921693184,
    bus_range: 0..255,
    function: 0,
    is_mulitple_function: false,
    is_finish: false,
    accessor: LoongArchConfigAccessor {
        cfg0: 1090921693184,
        cfg1: 1091190128640,
        root_bus: 0,
    },
}
[INFO  0] (hvisor::pci::pci_struct:942) pci dev next
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00000000 0000:00:00.0
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0x14
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 0
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 1
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 2
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 3
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 4
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 5
[INFO  0] (hvisor::pci::pci_struct:798) BARs []

[INFO  0] (hvisor::pci::pci_struct:752) get node bar mem init end BARs []

[INFO  0] (hvisor::pci::pci_struct:1415) capability {
    64: HyperTransport 40,
    96: HyperTransport 60,
    108: HyperTransport 6c,
    112: HyperTransport 70,
    192: HyperTransport c0,
}
[INFO  0] (hvisor::pci::pci_config:140) node 
  bdf 0000:00:00.0
  base 0xfe00000000
  type Endpoint
  BARs []
 [Unused]
[INFO  0] (hvisor::pci::pci_struct:942) pci dev next
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00000100 0000:00:00.1
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0x14
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 0
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 1
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 2
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 3
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 4
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 5
[INFO  0] (hvisor::pci::pci_struct:798) BARs []

[INFO  0] (hvisor::pci::pci_struct:752) get node bar mem init end BARs []

[INFO  0] (hvisor::pci::pci_struct:1415) capability {}
[INFO  0] (hvisor::pci::pci_config:140) node 
  bdf 0000:00:00.1
  base 0xfe00000100
  type Endpoint
  BARs []
 [Unused]
[INFO  0] (hvisor::pci::pci_struct:942) pci dev next
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00000200 0000:00:00.2
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0x14
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 0
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 1
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 2
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 3
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 4
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 5
[INFO  0] (hvisor::pci::pci_struct:798) BARs []

[INFO  0] (hvisor::pci::pci_struct:752) get node bar mem init end BARs []

[INFO  0] (hvisor::pci::pci_struct:1415) capability {}
[INFO  0] (hvisor::pci::pci_config:140) node 
  bdf 0000:00:00.2
  base 0xfe00000200
  type Endpoint
  BARs []
 [Unused]
[INFO  0] (hvisor::pci::pci_struct:942) pci dev next
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00000300 0000:00:00.3
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0x14
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 0
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 1
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 2
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 3
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 4
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 5
[INFO  0] (hvisor::pci::pci_struct:798) BARs []

[INFO  0] (hvisor::pci::pci_struct:752) get node bar mem init end BARs []

[INFO  0] (hvisor::pci::pci_struct:1415) capability {}
[INFO  0] (hvisor::pci::pci_config:140) node 
  bdf 0000:00:00.3
  base 0xfe00000300
  type Endpoint
  BARs []
 [Unused]
[INFO  0] (hvisor::pci::pci_struct:942) pci dev next
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00000400 0000:00:00.4
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:00.4
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00000500 0000:00:00.5
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:00.5
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00000600 0000:00:00.6
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:00.6
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00000700 0000:00:00.7
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:00.7
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00000800 0000:00:01.0
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:713) get none - device not present (vendor_id=0xffff) at 0000:00:01.0
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00001000 0000:00:02.0
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:713) get none - device not present (vendor_id=0xffff) at 0000:00:02.0
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00001800 0000:00:03.0
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:713) get none - device not present (vendor_id=0xffff) at 0000:00:03.0
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002000 0000:00:04.0
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0x14
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 0
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 2
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 3
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 4
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 5
[INFO  0] (hvisor::pci::pci_struct:798) BARs [
   slot 0 [mem 0x41340000-0x41348000 64bit]
]
[INFO  0] (hvisor::pci::pci_struct:752) get node bar mem init end BARs [
   slot 0 [mem 0x60000000-0x60008000 64bit]
]
[INFO  0] (hvisor::pci::pci_struct:1415) capability {}
[INFO  0] (hvisor::pci::pci_config:140) node 
  bdf 0000:00:04.0
  base 0xfe00002000
  type Endpoint
  BARs [
   slot 0 [mem 0x60000000-0x60008000 64bit]
] [Unused]
[INFO  0] (hvisor::pci::pci_struct:942) pci dev next
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002100 0000:00:04.1
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0x14
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 0
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 2
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 3
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 4
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 5
[INFO  0] (hvisor::pci::pci_struct:798) BARs [
   slot 0 [mem 0x41348000-0x41350000 64bit]
]
[INFO  0] (hvisor::pci::pci_struct:752) get node bar mem init end BARs [
   slot 0 [mem 0x60008000-0x60010000 64bit]
]
[INFO  0] (hvisor::pci::pci_struct:1415) capability {}
[INFO  0] (hvisor::pci::pci_config:140) node 
  bdf 0000:00:04.1
  base 0xfe00002100
  type Endpoint
  BARs [
   slot 0 [mem 0x60008000-0x60010000 64bit]
] [Unused]
[INFO  0] (hvisor::pci::pci_struct:942) pci dev next
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002200 0000:00:04.2
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:04.2
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002300 0000:00:04.3
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:04.3
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002400 0000:00:04.4
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:04.4
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002500 0000:00:04.5
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:04.5
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002600 0000:00:04.6
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:04.6
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002700 0000:00:04.7
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:04.7
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002800 0000:00:05.0
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0x14
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 0
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 2
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 3
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 4
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 5
[INFO  0] (hvisor::pci::pci_struct:798) BARs [
   slot 0 [mem 0x41350000-0x41358000 64bit]
]
[INFO  0] (hvisor::pci::pci_struct:752) get node bar mem init end BARs [
   slot 0 [mem 0x60010000-0x60018000 64bit]
]
[INFO  0] (hvisor::pci::pci_struct:1415) capability {}
[INFO  0] (hvisor::pci::pci_config:140) node 
  bdf 0000:00:05.0
  base 0xfe00002800
  type Endpoint
  BARs [
   slot 0 [mem 0x60010000-0x60018000 64bit]
] [Unused]
[INFO  0] (hvisor::pci::pci_struct:942) pci dev next
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002900 0000:00:05.1
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0x14
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 0
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 2
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 3
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 4
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 5
[INFO  0] (hvisor::pci::pci_struct:798) BARs [
   slot 0 [mem 0x41358000-0x41360000 64bit]
]
[INFO  0] (hvisor::pci::pci_struct:752) get node bar mem init end BARs [
   slot 0 [mem 0x60018000-0x60020000 64bit]
]
[INFO  0] (hvisor::pci::pci_struct:1415) capability {}
[INFO  0] (hvisor::pci::pci_config:140) node 
  bdf 0000:00:05.1
  base 0xfe00002900
  type Endpoint
  BARs [
   slot 0 [mem 0x60018000-0x60020000 64bit]
] [Unused]
[INFO  0] (hvisor::pci::pci_struct:942) pci dev next
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002a00 0000:00:05.2
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:05.2
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002b00 0000:00:05.3
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:05.3
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002c00 0000:00:05.4
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:05.4
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002d00 0000:00:05.5
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:05.5
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002e00 0000:00:05.6
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:05.6
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00002f00 0000:00:05.7
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0xffff
[WARN  0] (hvisor::pci::pci_struct:721) get none - function not present (vendor_id=0xffff) at 0000:00:05.7
[INFO  0] (hvisor::pci::pci_struct:700) get node fe00003000 0000:00:06.0
[WARN  0] (hvisor::pci::pci_struct:706) vender_id 0x14
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 0
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 2
[WARN  0] (hvisor::pci::pci_access:568) parse bar slot 4
[INFO  0] (hvisor::pci::pci_struct:798) BARs [
   slot 0 [mem 0x41360000-0x41360100 64bit]
   slot 2 [mem 0x30000000-0x40000000 64bit]
   slot 4 [mem 0x41300000-0x41310000 64bit]
]
[ERROR 0] (hvisor::pci::mem_alloc:142) alloc mem64 failed, ptr: 80000000, size: 10000, mem: [60000000-80000000], ptr+size=80010000
[ERROR 0] (hvisor::pci::mem_alloc:143) mem: 1610612736..2147483648
[ERROR 0] (hvisor::panic:24) panic occurred: PanicInfo {
    payload: Any { .. },
    message: Some(
        called `Option::unwrap()` on a `None` value,
    ),
    location: Location {
        file: "src/pci/pci_struct.rs",
        line: 816,
        col: 76,
    },
    can_unwind: true,
    force_no_backtrace: false,
}


